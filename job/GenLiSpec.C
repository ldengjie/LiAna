#include  <iostream>
#include  <TLegend.h>
#include  <TChain.h>
#include  <TH1F.h>
#include  <TFile.h>
#include  <TCanvas.h>
#include  <TROOT.h>
#include  <string>
int anaTree()
{
	gROOT->ProcessLine(".L LiTree.C+");
	TChain chain("Tree/LiTree"); //P12E P12A
	TChain chain2("Tree/LiTree");//P12E P12A
	TChain chain3("Tree/LiTree");//P12E P12A
	TChain chain4("Tree/LiTree");//P13A
	TChain chain5("Tree/LiTree");//P13A
	TChain chain6("Tree/LiTree");//P13A
	TChain chain7("Tree/LiTree");//P12E P12A
	TChain chain8("Tree/LiTree");//P12E P12A
	TChain chain9("Tree/LiTree");//P12E P12A
	TChain chain10("Tree/LiTree");//P14A
	TChain chain11("Tree/LiTree");//P14A
	TChain chain12("Tree/LiTree");//P14A
	TString chainFile;
	
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P12E/EH1/*LiAna.root";
	chain.Add(chainFile);
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P12A/EH1/*LiAna.root";
	chain.Add(chainFile);
    std::cout<<"chain entries  : "<<chain.GetEntries()<<endl;
	chain.Process("LiTree","EH1Spec_P12EP12A.root");
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P12E/EH2/*LiAna.root";
	chain2.Add(chainFile);
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P12A/EH2/*LiAna.root";
	chain2.Add(chainFile);
    std::cout<<"chain2 entries  : "<<chain2.GetEntries()<<endl;
	chain2.Process("LiTree","EH2Spec_P12EP12A.root");
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P12E/EH3/*LiAna.root";
	chain3.Add(chainFile);
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P12A/EH3/*LiAna.root";
	chain3.Add(chainFile);
	chain3.Process("LiTree","EH3Spec_P12EP12A.root");

    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P13A/EH1/*LiAna.root";
	chain4.Add(chainFile);
	chain4.Process("LiTree","EH1Spec_P13A.root");
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P13A/EH2/*LiAna.root";
	chain5.Add(chainFile);
	chain5.Process("LiTree","EH2Spec_P13A.root");
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P13A/EH3/*LiAna.root";
	chain6.Add(chainFile);
	chain6.Process("LiTree","EH3Spec_P13A.root");

    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P14A/EH1/*LiAna.root";
	chain10.Add(chainFile);
	chain10.Process("LiTree","EH1Spec_P14A.root");
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P14A/EH2/*LiAna.root";
	chain11.Add(chainFile);
	chain11.Process("LiTree","EH2Spec_P14A.root");
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P14A/EH3/*LiAna.root";
	chain12.Add(chainFile);
	chain12.Process("LiTree","EH3Spec_P14A.root");

    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P12E/EH1/*LiAna.root";
	chain7.Add(chainFile);
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P12A/EH1/*LiAna.root";
	chain7.Add(chainFile);
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P13A/EH1/*LiAna.root";
	chain7.Add(chainFile);
	chain7.Process("LiTree","EH1Spec_P12EP12AP13A.root");
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P12E/EH2/*LiAna.root";
	chain8.Add(chainFile);
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P12A/EH2/*LiAna.root";
	chain8.Add(chainFile);
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P13A/EH2/*LiAna.root";
    chain8.Add(chainFile);
	chain8.Process("LiTree","EH2Spec_P12EP12AP13A.root");
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P12E/EH3/*LiAna.root";
	chain9.Add(chainFile);
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P12A/EH3/*LiAna.root";
	chain9.Add(chainFile);
    chainFile="/afs/ihep.ac.cn/users/l/lidj/largedata/LiAna/P13A/EH3/*LiAna.root";
	chain9.Add(chainFile);
    chain9.Process("LiTree","EH3Spec_P12EP12AP13A.root");

    TFile* f1=new TFile("EH1Spec_P12EP12A.root");
    TH1F* h1=(TH1F*)f1->Get("LiSpec");
    TH1F* h10=(TH1F*)f1->Get("LiSpecWithMR");
    TFile* f2=new TFile("EH2Spec_P12EP12A.root");
    TH1F* h2=(TH1F*)f2->Get("LiSpec");
    TH1F* h20=(TH1F*)f2->Get("LiSpecWithMR");
    TFile* f3=new TFile("EH3Spec_P12EP12A.root");
    TH1F* h3=(TH1F*)f3->Get("LiSpec");
    TH1F* h30=(TH1F*)f3->Get("LiSpecWithMR");
    TFile* f123=new TFile("Spec_P12EP12A.root","RECREATE");
    h1->Sumw2();
    h2->Sumw2();
    h3->Sumw2();
    h10->Sumw2();
    h20->Sumw2();
    h30->Sumw2();
    TH1F* h123=(TH1F*)h1->Clone();
    h123->Sumw2();
    h123->Add(h2,1);
    h123->Add(h3,1);
    TH1F* h13=(TH1F*)h1->Clone();
    h13->Sumw2();
    h13->Add(h3,1);
    TH1F* h123Scaled=(TH1F*)h123->Clone();
    h123Scaled->SetName("LiSpecScaled");
    h123Scaled->Sumw2();
    h123Scaled->Scale(1/h123Scaled->Integral());
    h123->Write();
    h123Scaled->Write();
    h123Scaled->SetLineColor(kRed);
    TH1F* h13Scaled=(TH1F*)h13->Clone();
    h13Scaled->SetName("LiSpecScaledWOEH2");
    h13Scaled->Sumw2();
    h13Scaled->Scale(1/h13Scaled->Integral());
    h13Scaled->SetLineColor(kRed);
    h13->SetName("LiSpecWOEH2");
    h13->Write();
    h13Scaled->Write();

    TH1F* h1230=(TH1F*)h10->Clone();
    h1230->Sumw2();
    h1230->Add(h20,1);
    h1230->Add(h30,1);
    TH1F* h130=(TH1F*)h10->Clone();
    h130->Sumw2();
    h130->Add(h30,1);
    TH1F* h1230Scaled=(TH1F*)h1230->Clone();
    h1230Scaled->SetName("LiSpecScaledWithMR");
    h1230Scaled->Sumw2();
    h1230Scaled->Scale(1/h1230Scaled->Integral());
    h1230->Write();
    h1230Scaled->Write();
    h1230Scaled->SetLineColor(kGreen);
    TH1F* h130Scaled=(TH1F*)h130->Clone();
    h130Scaled->SetName("LiSpecScaledWOEH2WithMR");
    h130Scaled->Sumw2();
    h130Scaled->Scale(1/h130Scaled->Integral());
    h130Scaled->SetLineColor(kGreen);
    h130->SetName("LiSpecWOEH2WithMR");
    h130->Write();
    h130Scaled->Write();

    TFile* f4=new TFile("EH1Spec_P13A.root");
    TH1F* h4=(TH1F*)f4->Get("LiSpec");
    TFile* f5=new TFile("EH2Spec_P13A.root");
    TH1F* h5=(TH1F*)f5->Get("LiSpec");
    TFile* f6=new TFile("EH3Spec_P13A.root");
    TH1F* h6=(TH1F*)f6->Get("LiSpec");
    TFile* f456=new TFile("Spec_P13A.root","RECREATE");
    h4->Sumw2();
    h5->Sumw2();
    h6->Sumw2();
    TH1F* h456=(TH1F*)h4->Clone();
    h456->Sumw2();
    h456->Add(h5,1);
    h456->Add(h6,1);
    TH1F* h46=(TH1F*)h4->Clone();
    h46->Sumw2();
    h46->Add(h6,1);
    TH1F* h456Scaled=(TH1F*)h456->Clone();
    h456Scaled->SetName("LiSpecScaled");
    h456Scaled->Sumw2();
    h456Scaled->Scale(1/h456Scaled->Integral());
    h456Scaled->SetLineColor(kRed);
    h456->Write();
    h456Scaled->Write();
    TH1F* h46Scaled=(TH1F*)h46->Clone();
    h46Scaled->SetName("LiSpecScaledWOEH2");
    h46Scaled->Sumw2();
    h46Scaled->Scale(1/h46Scaled->Integral());
    h46Scaled->SetLineColor(kRed);
    h46->SetName("LiSpecWOEH2");
    h46->Write();
    h46Scaled->Write();
    TH1F* h40=(TH1F*)f4->Get("LiSpecWithMR");
    TH1F* h50=(TH1F*)f5->Get("LiSpecWithMR");
    TH1F* h60=(TH1F*)f6->Get("LiSpecWithMR");
    TFile* f4560=new TFile("Spec_P13A.root","RECREATE");
    h40->Sumw2();
    h50->Sumw2();
    h60->Sumw2();
    TH1F* h4056=(TH1F*)h40->Clone();
    h4056->Sumw2();
    h4056->Add(h50,1);
    h4056->Add(h60,1);
    TH1F* h406=(TH1F*)h40->Clone();
    h406->Sumw2();
    h406->Add(h60,1);
    TH1F* h4056Scaled=(TH1F*)h4056->Clone();
    h4056Scaled->SetName("LiSpecScaledWithMR");
    h4056Scaled->Sumw2();
    h4056Scaled->Scale(1/h4056Scaled->Integral());
    h4056Scaled->SetLineColor(kGreen);
    h4056->Write();
    h4056Scaled->Write();
    TH1F* h406Scaled=(TH1F*)h406->Clone();
    h406Scaled->SetName("LiSpecScaledWOEH2WithMR");
    h406Scaled->Sumw2();
    h406Scaled->Scale(1/h406Scaled->Integral());
    h406Scaled->SetLineColor(kGreen);
    h406->SetName("LiSpecWOEH2WithMR");
    h406->Write();
    h406Scaled->Write();

    TFile* fa4=new TFile("EH1Spec_P14A.root");
    TH1F* ha4=(TH1F*)fa4->Get("LiSpec");
    TFile* fa5=new TFile("EH2Spec_P14A.root");
    TH1F* ha5=(TH1F*)fa5->Get("LiSpec");
    TFile* fa6=new TFile("EH3Spec_P14A.root");
    TH1F* ha6=(TH1F*)fa6->Get("LiSpec");
    TFile* fa456=new TFile("Spec_P14A.root","RECREATE");
    ha4->Sumw2();
    ha5->Sumw2();
    ha6->Sumw2();
    TH1F* ha456=(TH1F*)ha4->Clone();
    ha456->Sumw2();
    ha456->Add(ha5,1);
    ha456->Add(ha6,1);
    TH1F* ha46=(TH1F*)ha4->Clone();
    ha46->Sumw2();
    ha46->Add(ha6,1);
    TH1F* ha456Scaled=(TH1F*)ha456->Clone();
    ha456Scaled->SetName("LiSpecScaled");
    ha456Scaled->Sumw2();
    ha456Scaled->Scale(1/ha456Scaled->Integral());
    ha456Scaled->SetLineColor(kRed);
    ha456->Write();
    ha456Scaled->Write();
    TH1F* ha46Scaled=(TH1F*)ha46->Clone();
    ha46Scaled->SetName("LiSpecScaledWOEH2");
    ha46Scaled->Sumw2();
    ha46Scaled->Scale(1/ha46Scaled->Integral());
    ha46Scaled->SetLineColor(kRed);
    ha46->SetName("LiSpecWOEH2");
    ha46->Write();
    ha46Scaled->Write();
    TH1F* ha40=(TH1F*)fa4->Get("LiSpecWithMR");
    TH1F* ha50=(TH1F*)fa5->Get("LiSpecWithMR");
    TH1F* ha60=(TH1F*)fa6->Get("LiSpecWithMR");
    TFile* fa4560=new TFile("Spec_P14A.root","RECREATE");
    ha40->Sumw2();
    ha50->Sumw2();
    ha60->Sumw2();
    TH1F* ha4056=(TH1F*)ha40->Clone();
    ha4056->Sumw2();
    ha4056->Add(ha50,1);
    ha4056->Add(ha60,1);
    TH1F* ha406=(TH1F*)ha40->Clone();
    ha406->Sumw2();
    ha406->Add(ha60,1);
    TH1F* ha4056Scaled=(TH1F*)ha4056->Clone();
    ha4056Scaled->SetName("LiSpecScaledWithMR");
    ha4056Scaled->Sumw2();
    ha4056Scaled->Scale(1/ha4056Scaled->Integral());
    ha4056Scaled->SetLineColor(kGreen);
    ha4056->Write();
    ha4056Scaled->Write();
    TH1F* ha406Scaled=(TH1F*)ha406->Clone();
    ha406Scaled->SetName("LiSpecScaledWOEH2WithMR");
    ha406Scaled->Sumw2();
    ha406Scaled->Scale(1/ha406Scaled->Integral());
    ha406Scaled->SetLineColor(kGreen);
    ha406->SetName("LiSpecWOEH2WithMR");
    ha406->Write();
    ha406Scaled->Write();

    TFile* f7=new TFile("EH1Spec_P12EP12AP13A.root");
    TH1F* h7=(TH1F*)f7->Get("LiSpec");
    TFile* f8=new TFile("EH2Spec_P12EP12AP13A.root");
    TH1F* h8=(TH1F*)f8->Get("LiSpec");
    TFile* f9=new TFile("EH3Spec_P12EP12AP13A.root");
    TH1F* h9=(TH1F*)f9->Get("LiSpec");
    TFile* f789=new TFile("Spec_P12EP12AP13A.root","RECREATE");
    h7->Sumw2();
    h8->Sumw2();
    h9->Sumw2();
    TH1F* h789=(TH1F*)h7->Clone();
    h789->Sumw2();
    h789->Add(h8,1);
    h789->Add(h9,1);
    TH1F* h79=(TH1F*)h7->Clone();
    h79->Sumw2();
    h79->Add(h9,1);
    TH1F* h789Scaled=(TH1F*)h789->Clone();
    h789Scaled->SetName("LiSpecScaled");
    h789Scaled->Sumw2();
    h789Scaled->Scale(1/h789Scaled->Integral());
    h789Scaled->SetLineColor(kRed);
    h789->Write();
    h789Scaled->Write();
    TH1F* h79Scaled=(TH1F*)h79->Clone();
    h79Scaled->SetName("LiSpecScaledWOEH2");
    h79Scaled->Sumw2();
    h79Scaled->Scale(1/h79Scaled->Integral());
    h79Scaled->SetLineColor(kRed);
    h79->SetName("LiSpecWOEH2");
    h79->Write();
    h79Scaled->Write();

    TH1F* h70=(TH1F*)f7->Get("LiSpecWithMR");
    TH1F* h80=(TH1F*)f8->Get("LiSpecWithMR");
    TH1F* h90=(TH1F*)f9->Get("LiSpecWithMR");
    TFile* f708090=new TFile("Spec_P12EP12AP13A.root","RECREATE");
    h70->Sumw2();
    h80->Sumw2();
    h90->Sumw2();
    TH1F* h708090=(TH1F*)h70->Clone();
    h708090->Sumw2();
    h708090->Add(h80,1);
    h708090->Add(h90,1);
    TH1F* h7090=(TH1F*)h70->Clone();
    h7090->Sumw2();
    h7090->Add(h90,1);
    TH1F* h708090Scaled=(TH1F*)h708090->Clone();
    h708090Scaled->SetName("LiSpecScaledWithMR");
    h708090Scaled->Sumw2();
    h708090Scaled->Scale(1/h708090Scaled->Integral());
    h708090Scaled->SetLineColor(kGreen);
    h708090->Write();
    h708090Scaled->Write();
    TH1F* h7090Scaled=(TH1F*)h7090->Clone();
    h7090Scaled->SetName("LiSpecScaledWOEH2WithMR");
    h7090Scaled->Sumw2();
    h7090Scaled->Scale(1/h7090Scaled->Integral());
    h7090Scaled->SetLineColor(kGreen);
    h7090->SetName("LiSpecWOEH2WithMR");
    h7090->Write();
    h7090Scaled->Write();

    //TFile* SpecCalFile=new TFile("specCalc_12bin.root");
    //TH1F* SpecCal=(TH1F*)SpecCalFile->Get("hSpecLi");
    TFile* SpecCalFile=new TFile("specCalc.root");
    TH1F* SpecCal=(TH1F*)SpecCalFile->Get("LiSpec_12bin");
    SpecCal->SetLineColor(kBlue);
    TCanvas *c1=new TCanvas("c1dj","c1dj",1200,1600);
    c1->Divide(2,4);
    c1->cd(1);
    h123Scaled->SetXTitle("P12A P12E");
    h123Scaled->Draw();
    h1230Scaled->Draw("same");
    SpecCal->Draw("same");
    TLegend *legend=new TLegend(.5,.85,.99,.99);
    legend->AddEntry(h123Scaled,"data w/o muon reduction","lp");
    legend->AddEntry(h1230Scaled,"data with muon reduction","lp");
    legend->AddEntry(SpecCal,"calculation","lp");
    legend->SetFillColor(0);
    legend->Draw("same");
    c1->cd(5);
    h13Scaled->SetXTitle("P12A P12E : w/o EH2");
    h13Scaled->Draw();
    h130Scaled->Draw("same");
    SpecCal->Draw("same");
    TLegend *legend4=new TLegend(.5,.85,.99,.99);
    legend4->AddEntry(h13Scaled,"data w/o muon reduction","lp");
    legend4->AddEntry(h130Scaled,"data with muon reduction","lp");
    legend4->AddEntry(SpecCal,"calculation","lp");
    legend4->SetFillColor(0);
    legend4->Draw("same");

    c1->cd(2);
    h456Scaled->SetXTitle("P13A");
    h456Scaled->Draw();
    h4056Scaled->Draw("same");
    SpecCal->Draw("same");
    TLegend *legend2=new TLegend(.5,.85,.99,.99);
    legend2->AddEntry(h456Scaled,"data w/o muon reduction","lp");
    legend2->AddEntry(h4056Scaled,"data with muon reduction","lp");
    legend2->AddEntry(SpecCal,"calculation","lp");
    legend2->SetFillColor(0);
    legend2->Draw("same");
    c1->cd(6);
    h46Scaled->SetXTitle("P13A : w/o EH2");
    h46Scaled->Draw();
    h406Scaled->Draw("same");
    SpecCal->Draw("same");
    TLegend *legend5=new TLegend(.5,.85,.99,.99);
    legend5->AddEntry(h46Scaled,"data w/o muon reduction","lp");
    legend5->AddEntry(h406Scaled,"data with muon reduction","lp");
    legend5->AddEntry(SpecCal,"calculation","lp");
    legend5->SetFillColor(0);
    legend5->Draw("same");

    c1->cd(4);
    ha456Scaled->SetXTitle("P14A");
    ha456Scaled->Draw();
    ha4056Scaled->Draw("same");
    SpecCal->Draw("same");
    TLegend *legenda2=new TLegend(.5,.85,.99,.99);
    legenda2->AddEntry(ha456Scaled,"data w/o muon reduction","lp");
    legenda2->AddEntry(ha4056Scaled,"data with muon reduction","lp");
    legenda2->AddEntry(SpecCal,"calculation","lp");
    legenda2->SetFillColor(0);
    legenda2->Draw("same");
    c1->cd(8);
    ha46Scaled->SetXTitle("P14A : w/o EH2");
    ha46Scaled->Draw();
    ha406Scaled->Draw("same");
    SpecCal->Draw("same");
    TLegend *legenda5=new TLegend(.5,.85,.99,.99);
    legenda5->AddEntry(ha46Scaled,"data w/o muon reduction","lp");
    legenda5->AddEntry(ha406Scaled,"data with muon reduction","lp");
    legenda5->AddEntry(SpecCal,"calculation","lp");
    legenda5->SetFillColor(0);
    legenda5->Draw("same");

    c1->cd(3);
    h789Scaled->SetXTitle("P12A P12E P13A");
    h789Scaled->Draw();
    h708090Scaled->Draw("same");
    SpecCal->Draw("same");
    TLegend *legend3=new TLegend(.5,.85,.99,.99);
    legend3->AddEntry(h789Scaled,"data w/o muon reduction","lp");
    legend3->AddEntry(h708090Scaled,"data with muon reduction","lp");
    legend3->AddEntry(SpecCal,"calculation","lp");
    legend3->SetFillColor(0);
    legend3->Draw("same");
    c1->cd(7);
    h79Scaled->SetXTitle("P12A P12E P13A : w/o EH2");
    h79Scaled->Draw();
    h7090Scaled->Draw("same");
    SpecCal->Draw("same");
    TLegend *legend6=new TLegend(.5,.85,.99,.99);
    legend6->AddEntry(h79Scaled,"data w/o muon reduction","lp");
    legend6->AddEntry(h7090Scaled,"data with muon reduction","lp");
    legend6->AddEntry(SpecCal,"calculation","lp");
    legend6->SetFillColor(0);
    legend6->Draw("same");

	return 0;
}
int GenLiSpec()
{
    //string dataVer="P13A";
        anaTree();
    return 0;
}
